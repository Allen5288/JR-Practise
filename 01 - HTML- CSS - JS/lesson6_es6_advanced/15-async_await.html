<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // async/await 是基于 Promise 的语法糖，用于更简洁地处理异步操作
        // async 函数返回一个 Promise 对象
        const fetchData = async () => {
            return "Data fetched";
        };

        // 使用 await 等待 Promise 解析
        const getData = async () => {
            const data = await fetchData();
            console.log(data);
        };

        getData(); // 输出: Data fetched
        // 错误处理
        const fetchWithError = async () => {
            throw new Error("Something went wrong");
        };
        const handleError = async () => {
            try {
                await fetchWithError();
            } catch (error) {
                console.error("Error:", error.message);
            }
        };
        handleError(); // 输出: Error: Something went wrong
        // 使用 async/await 处理多个异步操作
        const fetchUser = () => {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({ id: 1, name: "John Doe" });
                }, 1000);
            });
        };
        const fetchPosts = () => {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve([
                        { id: 1, title: "Post 1" },
                        { id: 2, title: "Post 2" },
                    ]);
                }, 2000);
            });
        };
        const fetchComments = () => {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve([
                        { id: 1, text: "Comment 1" },
                        { id: 2, text: "Comment 2" },
                    ]);
                }, 1500);
            });
        };
        const fetchAllData = async () => {
            try {
                const [user, posts, comments] = await Promise.all([
                    fetchUser(),
                    fetchPosts(),
                    fetchComments(),
                ]);
                console.log("User:", user);
                console.log("Posts:", posts);
                console.log("Comments:", comments);
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        };
        fetchAllData();
        // async/await 使得异步代码看起来更像同步代码，易于阅读和维护
        // 但是需要注意，async/await 仍然是基于 Promise 的，所以它们的行为和 Promise 一样
        // async/await 也可以与 Promise.all() 一起使用，以并行处理多个异步操作
        // 例如：
        const fetchDataWithTimeout = async (delay) => {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(`Data fetched after ${delay} ms`);
                }, delay);
            });
        };
        const fetchWithTimeout = async (request, timeout) => {
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => {
                    reject(new Error("Request timed out"));
                }, timeout);
            });
            return Promise.race([request, timeoutPromise]);
        };
        const fetchDataWithTimeoutExample = async () => {
            try {
                const result = await fetchWithTimeout(fetchDataWithTimeout(3000), 2000);
                console.log(result);
            } catch (error) {
                console.error("Error:", error.message);
            }
        };
        fetchDataWithTimeoutExample(); // 输出: Error: Request timed out
        // async/await 也可以与 Promise 

    </script>
</body>
</html>